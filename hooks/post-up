#!/usr/bin/env zsh
#
# This script will be evaluated after `rcup` finishes.

. $(dirname "$0")/../scripts/lib/utils.sh

if is_mac; then
  platform=osx
  [[ ! -e ~/bin/vscode ]] && ln -s "/Applications/Visual Studio Code.app/Contents/MacOS/Electron" ~/bin/vscode
fi

if [ -n "$platform" -a -f ~/.zshrc.$platform ]; then
  # TODO check if we need to use -e to test file existence
  if [ -f ~/.zshrc.platform ]; then
    if [ $? != 0 -o "$(readlink ~/.zshrc.platform)" != "$(ls -d ~)/.zshrc.$platform" ]; then
      warn "Failed to link ~/.zshrc.platform to ~/.zshrc.$platform, please check ~/.zshrc.platform"
    fi
  else
    ln -s ~/.zshrc.$platform ~/.zshrc.platform
  fi
fi

erb -T - $(dirname $0)/../vim/vimrc.generated.erb >~/.vim/vimrc.generated
erb -T - $(dirname $0)/../config/nvim/coc-settings.json.erb >~/.config/nvim/coc-settings.json

install_antibody() {
  curl -sfL git.io/antibody | sudo sh -s - -b /usr/local/bin
  antibody bundle <~/.dotfiles/zsh/plugins.txt >~/.zsh_plugins.sh
}
check_and_install_executable 'antibody' 'install_antibody'

# vim-autoformat depends on js-beautify.
install_js_beautify() {
  npm install -g js-beautify
}
check_and_install_executable 'js-beautify' 'install_js_beautify'

executables=(
  "netcat|nc"
  socat
  fzf
  fd
  hstr
  rlwrap
  ag
)
check_and_install_executables $executables

#!/usr/bin/env bash
#
# Get location by ip.
#
# Usage:
#   iplocation [ip]

set -e

case "$1" in
  '-h' | '--help')
    sed -ne '/^#/!q;s/.\{1,2\}//;1,2d;p' <"$0"
    exit 0
    ;;
esac

json="$(curl -s https://ipvigilante.com/$1)"
address=($(echo $json | jq -r '.data.continent_name, .data.country_name, (.data.subdivision_1_name | select(. != null)), (.data.subdivision_2_name | select(. != null)), .data.city_name'))
location="($(echo $json | jq -r '.data.longitude'),$(echo $json | jq -r '.data.latitude'))"
IFS=","
echo "${address[*]} $location"
